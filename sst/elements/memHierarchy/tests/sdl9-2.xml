<!--
Topology:
            Core  Core   Core   Core
             L1    L1     L1     L1
                Bus          Bus
                L2           L2
                      Bus
                      L3
                     Router
               DirectoryController
 
Uncached Requests
-->

<?xml version="1.0"?>
<sdl version="2.0"/>
<timebase>1ns</timebase>


<variables>
	<lat> 1ns </lat>
	<buslat> 10ns </buslat>
	<netlat> 2ns </netlat>
</variables>


<param_include>
    <cpuParams>
        <workPerCycle> 1000 </workPerCycle>
        <commFreq> 100 </commFreq>
        <memSize> 0x1000 </memSize>
        <num_loadstore> 1000 </num_loadstore>
        <do_write> 1 </do_write>
        <uncacheRangeStart> 0  </uncacheRangeStart>
        <uncacheRangeEnd> 0x100  </uncacheRangeEnd>
    </cpuParams>

    <l1Params>
        <cache_frequency> 2 Ghz  </cache_frequency>
        <cache_size> 4 KB </cache_size>
        <coherence_protocol> MSI </coherence_protocol>
        <replacement_policy> lru </replacement_policy> 
        <associativity> 4 </associativity>
        <access_latency_cycles> 5  </access_latency_cycles>
        <cache_line_size> 64 </cache_line_size>
        <L1> 1 </L1>
        <debug> ${MEM_DEBUG} </debug>
        <statistics> 1 </statistics>
    </l1Params>

    <l2Params>
        <cache_frequency> 2 Ghz  </cache_frequency>
        <cache_size> 32 KB </cache_size>
        <coherence_protocol> MSI </coherence_protocol>
        <replacement_policy> lru </replacement_policy> 
        <associativity> 8 </associativity>
        <access_latency_cycles> 20  </access_latency_cycles>
        <cache_line_size> 64 </cache_line_size>
        <debug> ${MEM_DEBUG} </debug>
        <statistics> 1 </statistics>
    </l2Params>
    
    <l3Params>
        <cache_frequency> 2 Ghz  </cache_frequency>
        <cache_size> 64 KB </cache_size>
        <coherence_protocol> MSI </coherence_protocol>
        <replacement_policy> lru </replacement_policy> 
        <associativity> 16 </associativity>
        <access_latency_cycles> 100  </access_latency_cycles>
        <directory_at_next_level> 1 </directory_at_next_level>
        <cache_line_size> 64 </cache_line_size>
        <debug> ${MEM_DEBUG} </debug>
        <statistics> 1 </statistics>
    </l3Params>

    <busParams>
        <bus_frequency> 2 Ghz </bus_frequency>
    </busParams>
    
    <routerParams>
        <num_ports> 2 </num_ports>
        <num_vcs> 3 </num_vcs>
        <link_bw> 5GHz </link_bw>
        <xbar_bw> 5GHz </xbar_bw>
        <topology> merlin.singlerouter </topology>
        <id> 0 </id>
    </routerParams>
    
    <directoryParams>
        <coherence_protocol> MSI </coherence_protocol>
        <network_address> 0 </network_address>
        <network_bw> 1GHz </network_bw>
        <addr_range_start> 0x0 </addr_range_start>
        <addr_range_end> 0x1F000000 </addr_range_end> <!-- 512MB - 16MB for backingStoreSize -->
        <backing_store_size> 0x1000000 </backing_store_size> <!-- 16 MB -->
        <entry_cache_size> 8192 </entry_cache_size>
        <debug> ${MEM_DEBUG} </debug>
    </directoryParams>
    
    <memParams>
        <coherence_protocol> MSI </coherence_protocol>
        <access_time> 100 ns </access_time>
        <mem_size> 512 </mem_size>
        <clock> 1GHz </clock>
        <debug> ${MEM_DEBUG} </debug>
	</memParams>
</param_include>

<sst>
	<component name="cpu0" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c0l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c0.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c0l1cache_link port=high_network_0 latency=$lat />
		<link name=c0l1cache_bus port=low_network_0 latency=$buslat />
	</component>
    
    <component name="cpu1" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c1l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c1.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c1l1cache_link port=high_network_0 latency=$lat />
		<link name=c1l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="cpu2" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c2l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c2.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c2l1cache_link port=high_network_0 latency=$lat />
		<link name=c2l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="cpu3" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c3l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c3.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c3l1cache_link port=high_network_0 latency=$lat />
		<link name=c3l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="n0.bus" type="memHierarchy.Bus">
        <params include=busParams />
        <link name=c0l1cache_bus port=high_network_0 latency=$buslat />
        <link name=c1l1cache_bus port=high_network_1 latency=$buslat />
        <link name=c2l1cache_bus port=high_network_2 latency=$buslat />
        <link name=c3l1cache_bus port=high_network_3 latency=$buslat />
		<link name=n0bus_l2cache port=low_network_0 latency=$buslat />
	</component>

    <component name="n0.l2cache" type="memHierarchy.Cache">
        <params include=l2Params />
        <link name=n0bus_l2cache port=high_network_0 latency=$buslat />
		<link name=n0l2cache_bus port=low_network_0 latency=$buslat />
	</component>
    
    <component name="cpu4" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c4l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c4.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c4l1cache_link port=high_network_0 latency=$lat />
		<link name=c4l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="cpu5" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c5l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c5.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c5l1cache_link port=high_network_0 latency=$lat />
		<link name=c5l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="cpu6" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c6l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c6.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c6l1cache_link port=high_network_0 latency=$lat />
		<link name=c6l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="cpu7" type="memHierarchy.trivialCPU">
        <params include=cpuParams />
		<link name=c7l1cache_link port=mem_link latency=$lat />
	</component>

	<component name="c7.l1cache" type="memHierarchy.Cache">
        <params include=l1Params />
		<link name=c7l1cache_link port=high_network_0 latency=$lat />
		<link name=c7l1cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="n1.bus" type="memHierarchy.Bus">
        <params include=busParams />
        <link name=c4l1cache_bus port=high_network_0 latency=$buslat />
        <link name=c5l1cache_bus port=high_network_1 latency=$buslat />
        <link name=c6l1cache_bus port=high_network_2 latency=$buslat />
        <link name=c7l1cache_bus port=high_network_3 latency=$buslat />
		<link name=n1bus_l2cache port=low_network_0 latency=$buslat />
	</component>

    <component name="n1.l2cache" type="memHierarchy.Cache">
        <params include=l2Params />
        <link name=n1bus_l2cache port=high_network_0 latency=$buslat />
		<link name=n1l2cache_bus port=low_network_0 latency=$buslat />
	</component>

    <component name="n2.bus" type="memHierarchy.Bus">
        <params include=busParams />
        <link name=n0l2cache_bus port=high_network_0 latency=$buslat />
        <link name=n1l2cache_bus port=high_network_1 latency=$buslat />
		<link name=n2bus_l3cache port=low_network_0 latency=$buslat />
	</component>

	<component name="l3cache" type="memHierarchy.Cache">
        <params include=l3Params>
            <network_address> 1 </network_address>
        </params>
		<link name=n2bus_l3cache port=high_network_0 latency=$buslat />
		<link name=cache_net_0 port=directory latency=$buslat />
	</component>


    <component name="chiprtr" type="merlin.hr_router">
        <params include=routerParams />
        <link name=cache_net_0 port=port1 latency=$netlat />
        <link name=dir_net_0 port=port0 latency=$netlat />
    </component>


    <component name="dirctrl" type="memHierarchy.DirectoryController">
        <params include=directoryParams>
            <network_address> 0 </network_address>
        </params>
        <link name=dir_net_0 port=network latency=$netlat />
        <link name=dir_mem_link port=memory latency=$buslat />
    </component>

	<component name="memory" type="memHierarchy.MemController">
        <params include=memParams />
		<link name=dir_mem_link port=direct_link latency=$buslat />
	</component>


</sst>
